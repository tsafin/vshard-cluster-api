## Messaging
### FIFO queue
`vshard.queue_create` - Создание распределенной очереди с гарантией fifo на уровне партиций. 

Формат запроса:
```lua
local result, err = vshard.queue_create(name, opts) 
```

* `name` - имя очереди
* `opts` - дополнительные опции запроса:
  * `read_timeout` - время ожидания чтения из очереди (по-умолчанию 10000 мс).
  * `write_timeout` - время ожидания записи в очередь (по-умолчанию 10000 мс).
  * `lock_timeout` - время блокировки записи при вызове `queue_peek` с параметром `lock=true` (по-умолчанию 10000 мс). 
  * `size` - максимальный размер очереди (по-умолчанию не ограничен). 
  * `ttl` - время жизни сообещния в очереди (в мс, по-умолчанию не ограничено). 
  Если задано, то по истечению времени сообщение не может быть прочитано из очереди и будет удалено.
* `result` - nil
* `err` - код ошибки, если при выполнении запроса произошла исключительная ситуация
  
Пример:
```lua
-- create new queue if not exists
local result, err = vshard.queue_create("system messages", { size = 100000, ttl = 100000})
```
---
`vshard.queue_put` - запись сообщения в очередь. 

Формат запроса:
```lua
local result, err = vshard.queue_put(name, message [, line, opts]) 
```

* `name` - имя очереди
* `message` - кортеж с данными для записи в очередь
* `line` - имя или идентификатор части очереди (партиции), по которому определяется узел для хранения сообщения в очереди. 
Сообщения в рамках одного `line` строкого упорядочены в порядке fifo.
* `opts` - дополнительные опции запроса:
  * `timeout` - время ожидания записи в очередь (по-умолчанию значение берется из опции `write_timeout` очереди).
  * `ttl` - время жизни сообещния в очереди. 
  Если задано, то по истечению времени сообщение не может быть прочитано из очереди и будет удалено.
* `result` - nil
* `err` - код ошибки, если при выполнении запроса произошла исключительная ситуация
  
Пример:
```lua
local result, err = vshard.queue_put("system messages", 
    {"some", "data"}, -- message
    1) -- идентификатор партиции
```
---
`vshard.queue_take` - чтение и удаление сообщения из очереди. 

Формат запроса:
```lua
local result, err = vshard.queue_take(name [, line, opts]) 
```

* `name` - имя очереди
* `line` - имя/идентификатор части очереди (партиции), по которому определяется узел для чтения сообщения из очереди. 
* `opts` - дополнительные опции запроса:
  * `timeout` - время ожидания записи в очередь (по-умолчанию значение берется из опции `read_timeout` очереди).
  Если задано, то по истечению времени сообщение не может быть прочитано из очереди и будет удалено.
* `result` - кортеж с данными
* `err` - код ошибки, если при выполнении запроса произошла исключительная ситуация
  
Пример:
```lua
local result, err = vshard.queue_take("system messages", 1)
```
---
`vshard.queue_peek` - чтение сообщения из очереди. Само сообщение при этом из очереди не удаляется. 

Формат запроса:
```lua
local result, err = vshard.queue_peek(name [, line, opts]) 
```

* `name` - имя очереди
* `line` - имя/идентификатор части очереди (партиции), по которому определяется узел для чтения сообщения из очереди. 
* `opts` - дополнительные опции запроса:
  * `timeout` - время ожидания сообщения в очереди (по-умолчанию значение берется из опции `read_timeout` очереди).
  * `lock` - boolean флаг, задает необходимость блокировки сообщения на чтение другими клиентами.
  * `lock_timeout` - время блокировки сообщения в очереди (по-умолчанию значение берется из опции `lock_timeout` очереди). 
  По истечению `lock_timeout` блокировка с сообщения будет удалена.
  Если задано, то по истечению времени сообщение не может быть прочитано из очереди и будет удалено.
* `result` - кортеж в формате `{lock_key, message}`, где `lock_key` является ключом блокировки и 
должен быть использован для удаления сообщения из очереди за период `lock_timeout`. Если `opts.lock == false`, 
то `lock_key == nil`
* `err` - код ошибки, если при выполнении запроса произошла исключительная ситуация
  
Пример:
```lua
local result, err = vshard.queue_peek("system messages", 1, { lock = true })
```
---
`vshard.queue_remove` - удаление заблокированного сообщения из очереди. 

Формат запроса:
```lua
local result, err = vshard.queue_remove(name, lock_key [, line, opts]) 
```

* `name` - имя очереди
* `lock_key` - ключ блокировки сообщения в очереди
* `line` - имя/идентификатор части очереди (партиции), по которому определяется узел для чтения сообщения из очереди. 
* `opts` - дополнительные опции запроса:
  * `timeout` - время ожидания сообщения в очереди (по-умолчанию значение берется из опции `write_timeout` очереди).
* `result` - `nil`
* `err` - код ошибки, если при выполнении запроса произошла исключительная ситуация
  
Пример:
```lua
local result, err = vshard.queue_remove("system messages", "93a1f8f0-4bba-4394-b678-bc609172e79f")
```
--- 
`vshard.queue_delete` - удаление существующей очереди или ее партиции. 

Формат запроса:
```lua
local result, err = vshard.queue_delete(name [, line, opts]) 
```

* `name` - имя очереди
* `line` - имя/идентификатор части очереди (партиции), по которому определяется узел для удаления сообщения из очереди. 
* `opts` - дополнительные опции запроса:
  * `force` - удаление непустой очереди (по-умолчанию `false`).
* `result` - `nil`
* `err` - код ошибки, если при выполнении запроса произошла исключительная ситуация
  
Пример:
```lua
err = vshard.queue_delete("system messages")
```
